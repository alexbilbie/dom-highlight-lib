(this.webpackJsonpdemo=this.webpackJsonpdemo||[]).push([[0],{14:function(e,t,n){"use strict";n.r(t);var r=n(6),o=(n(8),n(2)),i=n.n(o),a=n(5),u=n(0),c=n.n(u),s=n(1);function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var h=/^[\u0000-\u001F\u21B5\s]+|[\u0000-\u001F\u21B5\s]+$/gm,m=function(e,t){var n,r=t.minTextLength,o=t.trimInvisibleChars,i=t.ignoreInvisibleNodes,a=e.nodeValue||"";if(r>0&&(o?function(e){return e.replace(h,"")}(a):a).length<r)return!1;if(i){var u=e.parentElement;if(!u||!((n=u).offsetWidth||n.offsetHeight||n.getClientRects().length))return!1;if(!function(e){var t=e.left,n=e.right,r=e.top,o=e.bottom,i=window.innerWidth||document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight;return r>=0&&r<=a&&t>=0&&t<=i||o>=0&&o<=a&&t>=0&&t<=i||r>=0&&r<=a&&n>=0&&n<=i||o>=0&&o<=a&&n>=0&&n<=i}(u.getBoundingClientRect()))return!1}return!0},g=function(e){for(var t=document.createTreeWalker(e.root,NodeFilter.SHOW_TEXT,null,!1),n=[];t.nextNode();)m(t.currentNode,e)&&n.push(t.currentNode);return n},v=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},p=function(){function e(e){this.config=e,this.matches=new Map}var t=e.prototype;return t.detachRanges=function(){this.matches.forEach((function(e){return e.nodeRefs.forEach((function(e){return e.ranges.forEach((function(e){return e.detach}))}))}))},t.setTokens=function(e){try{var t=[];return e.forEach((function(e){0===e.nodeRefs.length?e.tokens=[]:t.push(e)})),Promise.resolve(this.config.match(t.map((function(e){return e.nodeRefs[0].node.nodeValue||""})))).then((function(e){for(var n=0;n<t.length;n+=1)t[n].tokens=e[n]}))}catch(n){return Promise.reject(n)}},t.setNodes=function(e){this.detachRanges();var t=this.matches,n=new Map;return e.forEach((function(e){var r=i()(e.nodeValue||""),o={node:e,ranges:[]},a=t.get(r),u=n.get(r);u?u.nodeRefs.push(o):n.set(r,{tokens:null===a||void 0===a?void 0:a.tokens,nodeRefs:[o]})})),this.matches=n,this.match()},t.match=function(e){void 0===e&&(e=!1);var t=[],n=Array.from(this.matches.values());e||(n=n.filter((function(e){return!e.tokens})));for(var r,o=this.config.minBatchTextLength,i=void 0===o?1e3:o,a=[],u=0,c=f(n);!(r=c()).done;){var s=r.value;s.nodeRefs.length>0&&(a.push(s),(u+=(s.nodeRefs[0].node.nodeValue||"").length)>i&&(t.push(this.setTokens(a)),a=[],u=0))}return a.length>0&&t.push(this.setTokens(a)),Promise.all(t).then((function(){}))},t.addNodes=function(e){var t=this,n=0;return e.map((function(e){return g(l({root:e},t.config))})).flat(2).forEach((function(e){var r=i()(e.nodeValue||""),o={node:e,ranges:[]},a=t.matches.get(r);a?a.nodeRefs.some((function(t){return t.node===e}))||(a.nodeRefs.push(o),n+=1):(t.matches.set(r,{nodeRefs:[o]}),n+=1)})),console.log("addNodes: found "+n+" new text nodes"),n>0?this.match():Promise.resolve()},t.removeNodes=function(e){var t=this,n=0,r=[];this.matches.forEach((function(o,i){o.nodeRefs=o.nodeRefs.filter((function(r){return!(!m(r.node,t.config)||e.some((function(e){return e===r.node||v(e,r.node)})))||(n+=1,r.ranges.forEach((function(e){return e.detach()})),!1)})),0===o.nodeRefs.length&&r.push(i)})),r.forEach((function(e){t.matches.delete(e)})),console.log("removeNodes: removed "+n+" text nodes")},t.updateNodes=function(e){return this.removeNodes(e),this.addNodes(e)},t.scan=function(){var e=function(e){var t=e.selectors,n=void 0===t?"":t,r=e.ignoreInvisibleNodes,o=void 0===r||r,i=e.trimInvisibleChars,a=void 0===i||i,u=e.minTextLength,c=void 0===u?3:u,s=document.documentElement;return(n?Array.from(s.querySelectorAll(n)):[s]).map((function(e){return g({root:e,ignoreInvisibleNodes:o,trimInvisibleChars:a,minTextLength:c})})).flat(2)}(this.config);return this.setNodes(e)},t.updateHighlights=function(){this.matches.forEach((function(e){return e.nodeRefs.forEach((function(t){t.ranges.forEach((function(e){return e.detach()})),t.ranges=(e.tokens||[]).map((function(e){return function(e,t){var n=document.createRange();return n.setStart(e.node,t.start),n.setEnd(e.node,t.end),n}(t,e)}))}))}))},e}(),b=function(e){var t=e.token,n=e.rect,r=e.onMouseEnter,o=e.onMouseLeave;return c.a.createElement("div",{onMouseEnter:function(e){return r(t,n,e)},onMouseLeave:function(e){return o(t,n,e)},style:{position:"fixed",top:n.top,left:n.left,width:n.width,height:n.height-1,borderBottom:"2px solid "+t.color,zIndex:2147483647}})},E=function(e,t,n){return void 0===n&&(n=[]),new MutationObserver((function(r){var o=n.map((function(e){return"string"===typeof e?e?Array.from(document.querySelectorAll(e)):[]:[e]})).flat(2),i=r;if(o&&(i=i.filter((function(e){var t=e.target;return t&&!o.some((function(e){return e===t||v(e,t)}))}))),0!==i.length){var a=i.map((function(e){return Array.from(e.removedNodes)})).flat(2);a.length>0&&e.removeNodes(a);var u=Promise.resolve(),c=i.filter((function(e){return"characterData"===e.type}));c.length>0&&(u=u.then((function(){return e.updateNodes(c.map((function(e){return e.target})))})));var s=i.map((function(e){return Array.from(e.addedNodes)})).flat(2);s.length>0&&(u=u.then((function(){return e.addNodes(s)}))),u.then(t).catch((function(e){console.error("Failed to process MutationRecords",i,e)}))}}))},y=null,w=null,k=function(e){var t=e.highlighter,n=e.throttleUpdates,r=e.ignoreMutations,o=e.onMouseEnterItem,i=e.onMouseLeaveItem,s=Object(u.useState)(0),l=s[0],d=s[1];return Object(u.useEffect)((function(){var e;!function(){var e;y&&(window.removeEventListener("scroll",y),window.removeEventListener("resize",y),y=null,null===(e=w)||void 0===e||e.disconnect())}();var o=function(){return d((function(e){return e+1}))},i=function(e){console.log("Scan triggered by "+e.type),t.scan().then(o)},u=Object(a.a)(i,n);window.addEventListener("scroll",u),window.addEventListener("resize",u),y=u,w||(w=E(t,o,r)),null===(e=w)||void 0===e||e.observe(document.documentElement,{attributes:!1,childList:!0,subtree:!0}),i({type:"page load"})}),[t,n,d,r]),console.log("Rendering highlights...#"+l),t.updateHighlights(),c.a.createElement(c.a.Fragment,null,Array.from(t.matches.values()).map((function(e,t){return e.nodeRefs.map((function(n,r){return n.ranges.filter(Boolean).map((function(n,a){var u=(e.tokens||[])[a];return Array.from(n.getClientRects()).map((function(e,n){return c.a.createElement(b,{key:[t,r,u.id,a,n].join("-"),token:u,rect:e,onMouseEnter:o,onMouseLeave:i})}))}))}))})).flat(4))},N=function(e){var t=e.data;return t?c.a.createElement("div",{className:"token-view",style:{background:t.token.color,top:t.rect.bottom,left:t.rect.left}},c.a.createElement("ul",null,c.a.createElement("li",null,"Card ID: ",t.token.id),c.a.createElement("li",null,"Title: ",t.token.keyword))):null},R=function(){var e=["red","pink","orange","purple","blue","black","green"];return e[Math.floor(1e3*Math.random())%e.length]},M=0,x=function(e){var t=function(){var e=localStorage.getItem("yali-dh-regex");return e?new RegExp(e,"mg"):/\w+/gm}();return new Promise((function(n,r){var o=function(e){for(var n=[],r=t.exec(e);null!==r;)n.push({id:M.toString(),color:R(),start:r.index,end:r.index+r[0].length,keyword:r[0]}),M+=1,r=t.exec(e);return n};setTimeout((function(){try{var t=e.map(o);n(t)}catch(i){r(i)}}),5)}))},T=function(e){var t=e.container,n=Object(u.useState)(null),o=Object(r.a)(n,2),i=o[0],a=o[1];Object(u.useEffect)((function(){!function(e){var t=new p(e),n=document.createElement("highlights");e.className&&n.setAttribute("class",e.className),document.body.appendChild(n),Object(s.render)(c.a.createElement(k,{highlighter:t,throttleUpdates:e.throttleUpdates||500,onMouseEnterItem:e.showToken,onMouseLeaveItem:e.hideToken,ignoreMutations:[].concat(e.ignoreMutations,[n])}),n)}({match:x,showToken:function(e,t){a({token:e,rect:t})},hideToken:function(){return a(null)},className:"dh-underline",ignoreMutations:[t]})}),[a,t]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{onClick:function(){var e=document.createElement("div");e.innerHTML="New DIV element",document.body.appendChild(e)},style:{padding:"5px 1em"}},"Add New DOM Node, trigger mutation observer"),c.a.createElement(N,{data:i}))},A=document.createElement("div");A.style.margin="margin: 1em auto",document.body.appendChild(A),Object(s.render)(c.a.createElement(T,{container:A}),A)},7:function(e,t,n){e.exports=n(14)},8:function(e,t,n){}},[[7,1,2]]]);
//# sourceMappingURL=main.2d61f4b8.chunk.js.map