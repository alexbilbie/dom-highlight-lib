(this.webpackJsonpdemo=this.webpackJsonpdemo||[]).push([[0],{14:function(e,t,n){"use strict";n.r(t);var r=n(6),o=(n(8),n(3)),i=n.n(o),a=n(5),u=n(0),c=n.n(u),l=n(1);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var h=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{f(r,1,i(this.v))}catch(a){f(r,2,a)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?f(r,1,t?t(o):o):n?f(r,1,n(o)):f(r,2,o)}catch(a){f(r,2,a)}},r},e}();function f(e,t,n){if(!e.s){if(n instanceof h){if(!n.s)return void(n.o=f.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(f.bind(null,e,t),f.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}function m(e){return e instanceof h&&1&e.s}"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var v=function(){function e(e,t,n){void 0===n&&(n=1e3),this.getTextNodes=e,this.match=t,this.minBatchTextLength=n,this.matches=[]}var t=e.prototype;return t.groupNodes=function(e){var t=new Map;this.matches.forEach((function(e){t.set(e.nodeValueHash,e)}));var n=[],r=[];return e.forEach((function(e){var o=e.nodeValue||"",a=i()(o),u=t.get(a),c={node:e,nodeValueHash:a,tokens:u?u.tokens:[],ranges:[]};u?n.push(c):r.push(c)})),{unchanged:n,changedAndNew:r}},t.setTokens=function(e){try{var t=this,n=e.length,r=[],o=0,i=0;return Promise.resolve(function(e,t,n){for(var r;;){var o=e();if(m(o)&&(o=o.v),!o)return i;if(o.then){r=0;break}var i=n();if(i&&i.then){if(!m(i)){r=1;break}i=i.s}if(t){var a=t();if(a&&a.then&&!m(a)){r=2;break}}}var u=new h,c=f.bind(null,u,2);return(0===r?o.then(s):1===r?i.then(l):a.then(d)).then(void 0,c),u;function l(r){i=r;do{if(t&&(a=t())&&a.then&&!m(a))return void a.then(d).then(void 0,c);if(!(o=e())||m(o)&&!o.v)return void f(u,1,i);if(o.then)return void o.then(s).then(void 0,c);m(i=n())&&(i=i.v)}while(!i||!i.then);i.then(l).then(void 0,c)}function s(e){e?(i=n())&&i.then?i.then(l).then(void 0,c):l(i):f(u,1,i)}function d(){(o=e())?o.then?o.then(s).then(void 0,c):s(o):f(u,1,i)}}((function(){return i<n}),(function(){return!!(i+=1)}),(function(){var a=e[i];r.push(a),o+=(a.node.nodeValue||"").length;var u=function(){if(i===n-1||o>t.minBatchTextLength)return Promise.resolve(t.match(r.map((function(e){return e.node.nodeValue||""})))).then((function(e){for(var t=0;t<r.length;t+=1)r[t].tokens=e[t];r=[],o=0}))}();if(u&&u.then)return u.then((function(){}))})))}catch(a){return Promise.reject(a)}},t.scan=function(){try{var e=this;return e.matches.forEach((function(e){return e.ranges.forEach((function(e){return e.detach()}))})),Promise.resolve(e.getTextNodes()).then((function(t){var n=e.groupNodes(t),r=n.unchanged,o=n.changedAndNew;return console.log("Highlighter.scan: unchanged="+r.length+", changed and new: "+o.length),Promise.resolve(e.setTokens(o)).then((function(){e.matches=[].concat(r,o)}))}))}catch(t){return Promise.reject(t)}},t.updateHighlights=function(){for(var e,t=function(){var t=e.value;t.ranges.forEach((function(e){return e.detach()})),t.ranges=t.tokens.map((function(e){return function(e,t){var n=document.createRange();return n.setStart(e.node,t.start),n.setEnd(e.node,t.end),n}(t,e)}))},n=d(this.matches);!(e=n()).done;)t()},e}(),g=function(e){var t=e.token,n=e.rect,r=e.onMouseEnter,o=e.onMouseLeave;return c.a.createElement("div",{onMouseEnter:function(e){return r(t,n,e)},onMouseLeave:function(e){return o(t,n,e)},style:{position:"fixed",top:n.top,left:n.left,width:n.width,height:n.height-1,borderBottom:"2px solid "+t.color,zIndex:2147483647}})},p=null,b=function(e){var t=e.highlighter,n=e.throttleUpdates,r=e.onMouseEnterItem,o=e.onMouseLeaveItem,i=Object(u.useState)(0),l=i[0],s=i[1];return Object(u.useEffect)((function(){p&&(document.removeEventListener("scroll",p),window.removeEventListener("resize",p),p=null);var e=function(e){console.log("Re-scan triggered by "+("object"===typeof e&&e.type?e.type:e)),t.scan().then((function(){return s((function(e){return e+1}))}))},r=Object(a.a)(e,n);p=r,new MutationObserver((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("DOM change:",t),r("MutationObserver")})).observe(document.documentElement,{attributes:!1,childList:!0,subtree:!0}),e("page load"),document.addEventListener("scroll",r),window.addEventListener("resize",r)}),[t,n,s]),console.log("Rendering highlights...#"+l),t.updateHighlights(),c.a.createElement(c.a.Fragment,null,t.matches.map((function(e,t){return e.ranges.filter(Boolean).map((function(n,i){var a=e.tokens[i];return Array.from(n.getClientRects()).map((function(e,n){return c.a.createElement(g,{key:[t,a.id,n].join("-"),token:a,rect:e,onMouseEnter:r,onMouseLeave:o})}))}))})).flat(3))},y=function(e){var t=e.left,n=e.right,r=e.top,o=e.bottom,i=window.innerWidth||document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight;return r>=0&&r<=a&&t>=0&&t<=i||o>=0&&o<=a&&t>=0&&t<=i||r>=0&&r<=a&&n>=0&&n<=i||o>=0&&o<=a&&n>=0&&n<=i},E=/^[\u0000-\u001F\u21B5\s]+|[\u0000-\u001F\u21B5\s]+$/gm,w=function(e){return e.replace(E,"")},k=function(e,t,n,r){void 0===e&&(e=""),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===r&&(r=3);var o=document.documentElement;return(e?Array.from(o.querySelectorAll(e)):[o]).map((function(e){return function(e,t,n,r){for(var o,i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),a=[];i.nextNode();){var u=i.currentNode,c=u.nodeValue||"";if(r>0)if((n?w(c):c).length<r)continue;if(t){var l=u.parentElement;if(!l||!((o=l).offsetWidth||o.offsetHeight||o.getClientRects().length))continue;if(!y(l.getBoundingClientRect()))continue}a.push(u)}return a}(e,t,n,r)})).flat(2)},S=function(e){var t=e.data;return t?c.a.createElement("div",{className:"token-view",style:{background:t.token.color,top:t.rect.bottom,left:t.rect.left}},c.a.createElement("ul",null,c.a.createElement("li",null,"Card ID: ",t.token.id),c.a.createElement("li",null,"Title: ",t.token.keyword))):null},x=function(){var e=["red","pink","orange","purple","blue","black","green"];return e[Math.floor(1e3*Math.random())%e.length]},M=0,T=function(e){var t=function(){var e=localStorage.getItem("yali-dh-regex");return e?new RegExp(e,"mg"):/\w+/gm}();return new Promise((function(n,r){var o=function(e){for(var n=[],r=t.exec(e);null!==r;)n.push({id:M.toString(),color:x(),start:r.index,end:r.index+r[0].length,keyword:r[0]}),M+=1,r=t.exec(e);return n};setTimeout((function(){try{var t=e.map(o);n(t)}catch(i){r(i)}}),5)}))},I=function(){var e=Object(u.useState)(null),t=Object(r.a)(e,2),n=t[0],o=t[1];Object(u.useEffect)((function(){!function(e){var t=e.match,n=e.showToken,r=e.hideToken,o=e.selectors,i=void 0===o?"":o,a=e.ignoreInvisibleNodes,u=void 0===a||a,s=e.minTextLength,d=void 0===s?3:s,h=e.trimInvisibleChars,f=void 0===h||h,m=e.minBatchTextLength,g=void 0===m?1e3:m,p=e.className,y=void 0===p?"":p,E=e.throttleUpdates,w=void 0===E?500:E,S=new v((function(){return k(i,u,f,d)}),t,g),x=document.createElement("highlights");y&&x.setAttribute("class",y),document.body.appendChild(x),Object(l.render)(c.a.createElement(b,{highlighter:S,throttleUpdates:w,onMouseEnterItem:n,onMouseLeaveItem:r}),x)}({match:T,showToken:function(e,t){o({token:e,rect:t})},hideToken:function(){return o(null)},className:"dh-underline"})}),[o]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{onClick:function(){var e=document.createElement("div");e.innerHTML="New DIV element",document.body.appendChild(e)},style:{padding:"5px 1em"}},"Add New DOM Node, trigger mutation observer"),c.a.createElement(S,{data:n}))},N=document.createElement("div");N.style.margin="margin: 1em auto",document.body.appendChild(N),Object(l.render)(c.a.createElement(I,null),N)},7:function(e,t,n){e.exports=n(14)},8:function(e,t,n){}},[[7,1,2]]]);
//# sourceMappingURL=main.3cbcfcd2.chunk.js.map